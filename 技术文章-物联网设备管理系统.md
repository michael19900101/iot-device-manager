# ä»é›¶å¼€å§‹æ„å»ºç‰©è”ç½‘è®¾å¤‡ç®¡ç†ç³»ç»Ÿï¼šåŸºäºNettyçš„é«˜æ€§èƒ½IoTå¹³å°å®æˆ˜

## å¼•è¨€

åœ¨ç‰©è”ç½‘ï¼ˆIoTï¼‰å¿«é€Ÿå‘å±•çš„ä»Šå¤©ï¼Œè®¾å¤‡ç®¡ç†ç³»ç»Ÿçš„éœ€æ±‚æ—¥ç›Šå¢é•¿ã€‚ç„¶è€Œï¼Œå¯¹äºæƒ³è¦å­¦ä¹ IoTå¼€å‘çš„æ–°æ‰‹æ¥è¯´ï¼Œå¾€å¾€é¢ä¸´ä¸¤ä¸ªä¸»è¦æŒ‘æˆ˜ï¼š**ç¡¬ä»¶æˆæœ¬é«˜æ˜‚**å’Œ**å­¦ä¹ é—¨æ§›è¾ƒé«˜**ã€‚

ä»Šå¤©ï¼Œæˆ‘å°†åˆ†äº«ä¸€ä¸ªå®Œæ•´çš„ç‰©è”ç½‘è®¾å¤‡ç®¡ç†ç³»ç»Ÿé¡¹ç›®ï¼Œå®ƒåŸºäºNettyæ„å»ºï¼ŒåŒ…å«Javaåç«¯å’ŒVue.jså‰ç«¯ï¼Œ**é›¶ç¡¬ä»¶æˆæœ¬**å³å¯ä½“éªŒå®Œæ•´çš„IoTå¼€å‘æµç¨‹ã€‚è¿™ä¸ªé¡¹ç›®éå¸¸é€‚åˆæƒ³è¦å…¥é—¨ç‰©è”ç½‘å¼€å‘çš„æœ‹å‹ä»¬ï¼

## é¡¹ç›®æ¦‚è¿°

### ğŸ¯ é¡¹ç›®äº®ç‚¹
- **é›¶ç¡¬ä»¶æˆæœ¬**ï¼šå†…ç½®è™šæ‹Ÿè®¾å¤‡æ¨¡æ‹Ÿå™¨ï¼Œæ— éœ€è´­ä¹°æ˜‚è´µçš„ä¼ æ„Ÿå™¨ç¡¬ä»¶
- **é«˜æ€§èƒ½æ¶æ„**ï¼šåŸºäºNettyçš„é«˜å¹¶å‘å¤„ç†èƒ½åŠ›ï¼Œæ”¯æŒåƒçº§è®¾å¤‡åŒæ—¶æ¥å…¥
- **å®æ—¶é€šä¿¡**ï¼šWebSocketå®æ—¶æ•°æ®æ¨é€ï¼Œæ¯«ç§’çº§å“åº”
- **ç°ä»£åŒ–ç•Œé¢**ï¼šVue3 + Element Plusçš„å“åº”å¼è®¾è®¡
- **å®Œæ•´ç”Ÿæ€**ï¼šä»è®¾å¤‡æ¥å…¥åˆ°æ•°æ®å±•ç¤ºçš„å®Œæ•´è§£å†³æ–¹æ¡ˆ

### ğŸ“Š æŠ€æœ¯æ ˆ
- **åç«¯**ï¼šJava 11 + Netty 4.1.94 + Maven
- **å‰ç«¯**ï¼šVue 3 + Element Plus + WebSocket
- **é€šä¿¡åè®®**ï¼šTCP + WebSocket
- **æ—¥å¿—ç³»ç»Ÿ**ï¼šSLF4J + Logback

## æ ¸å¿ƒæ¶æ„è®¾è®¡

### 1. ç½‘ç»œé€šä¿¡å±‚

é¡¹ç›®é‡‡ç”¨**åŒæœåŠ¡å™¨æ¶æ„**ï¼š
- **TCPæœåŠ¡å™¨**ï¼ˆç«¯å£8888ï¼‰ï¼šå¤„ç†ç‰©è”ç½‘è®¾å¤‡çš„è¿æ¥å’Œæ•°æ®ä¼ è¾“
- **WebSocketæœåŠ¡å™¨**ï¼ˆç«¯å£8889ï¼‰ï¼šå‘å‰ç«¯æ¨é€å®æ—¶æ•°æ®

```java
// æ ¸å¿ƒæœåŠ¡å™¨å¯åŠ¨ä»£ç 
public class IoTApplication {
    private final IoTNettyServer tcpServer;      // TCPæœåŠ¡å™¨
    private final WebSocketServer webSocketServer; // WebSocketæœåŠ¡å™¨
    
    public IoTApplication(int tcpPort, int wsPort) {
        this.tcpServer = new IoTNettyServer(tcpPort, deviceManager);
        this.webSocketServer = new WebSocketServer(wsPort, deviceManager);
    }
}
```

### 2. è®¾å¤‡ç®¡ç†å±‚

**DeviceManager**æ˜¯ç³»ç»Ÿçš„æ ¸å¿ƒç»„ä»¶ï¼Œè´Ÿè´£ï¼š
- è®¾å¤‡æ³¨å†Œå’ŒçŠ¶æ€ç®¡ç†
- å¿ƒè·³æ£€æµ‹å’Œè¶…æ—¶å¤„ç†
- è®¾å¤‡æ•°æ®ç¼“å­˜å’Œè½¬å‘
- äº‹ä»¶ç›‘å¬å’Œé€šçŸ¥

```java
public class DeviceManager {
    private final Map<String, DeviceInfo> devices = new ConcurrentHashMap<>();
    private final List<DeviceStatusListener> statusListeners = new ArrayList<>();
    private final List<DeviceDataListener> dataListeners = new ArrayList<>();
    
    // è®¾å¤‡æ³¨å†Œ
    public void registerDevice(String deviceId, String deviceName, String deviceType, String clientIp) {
        DeviceInfo device = new DeviceInfo(deviceId, deviceName, deviceType, clientIp);
        devices.put(deviceId, device);
        notifyStatusChange(device, DeviceStatus.ONLINE);
    }
}
```

### 3. å‰ç«¯å®æ—¶å±•ç¤º

å‰ç«¯é‡‡ç”¨Vue3çš„å“åº”å¼è®¾è®¡ï¼Œé€šè¿‡WebSocketå®æ—¶æ¥æ”¶è®¾å¤‡çŠ¶æ€å˜æ›´ï¼š

```javascript
// WebSocketè¿æ¥å’Œæ•°æ®å¤„ç†
const ws = new WebSocket('ws://localhost:8889');
ws.onmessage = (event) => {
    const data = JSON.parse(event.data);
    if (data.type === 'DEVICE_STATUS_CHANGE') {
        updateDeviceStatus(data.device);
    }
};
```

## å…³é”®æŠ€æœ¯å®ç°

### 1. é«˜å¹¶å‘è®¾å¤‡æ¥å…¥

Nettyçš„å¼‚æ­¥éé˜»å¡ç‰¹æ€§ä½¿å¾—ç³»ç»Ÿèƒ½å¤Ÿè½»æ¾å¤„ç†å¤§é‡å¹¶å‘è¿æ¥ï¼š

```java
public class IoTNettyServer {
    private final EventLoopGroup bossGroup = new NioEventLoopGroup(1);
    private final EventLoopGroup workerGroup = new NioEventLoopGroup();
    
    public void start() {
        ServerBootstrap bootstrap = new ServerBootstrap();
        bootstrap.group(bossGroup, workerGroup)
                .channel(NioServerSocketChannel.class)
                .childHandler(new IoTDeviceHandler(deviceManager));
    }
}
```

### 2. è®¾å¤‡é€šä¿¡åè®®

ç³»ç»Ÿå®šä¹‰äº†ç®€æ´é«˜æ•ˆçš„è®¾å¤‡é€šä¿¡åè®®ï¼š

```
# è®¾å¤‡æ³¨å†Œ
REGISTER|è®¾å¤‡ID|è®¾å¤‡åç§°|è®¾å¤‡ç±»å‹

# å¿ƒè·³æ¶ˆæ¯
HEARTBEAT|è®¾å¤‡ID

# æ•°æ®ä¸ŠæŠ¥
DATA|{"temperature":28.64,"humidity":48.41}
```

### 3. å®æ—¶æ•°æ®æ¨é€

é€šè¿‡WebSocketå®ç°å‰ç«¯å®æ—¶æ•°æ®æ›´æ–°ï¼š

```java
public class WebSocketHandler {
    public void broadcastDeviceStatus(DeviceInfo device) {
        String message = JSON.toJSONString(new DeviceStatusMessage(device));
        for (Session session : sessions) {
            session.getAsyncRemote().sendText(message);
        }
    }
}
```

## é¡¹ç›®ç‰¹è‰²åŠŸèƒ½

### 1. è™šæ‹Ÿè®¾å¤‡æ¨¡æ‹Ÿå™¨

ä¸ºäº†è§£å†³ç¡¬ä»¶æˆæœ¬é—®é¢˜ï¼Œé¡¹ç›®æä¾›äº†å®Œæ•´çš„è®¾å¤‡æ¨¡æ‹Ÿå™¨ï¼š

- **å•ä¸ªè®¾å¤‡æ¨¡æ‹Ÿå™¨**ï¼šç”¨äºåŠŸèƒ½æµ‹è¯•å’Œè°ƒè¯•
- **æ‰¹é‡è®¾å¤‡æ¨¡æ‹Ÿå™¨**ï¼šæ”¯æŒ1000ä¸ªè®¾å¤‡å¹¶å‘æ¥å…¥ï¼Œç”¨äºå‹åŠ›æµ‹è¯•

```bash
# è¿è¡Œæ‰¹é‡æ¨¡æ‹Ÿå™¨
java -cp "target/classes:$(mvn dependency:build-classpath -Dmdep.outputFile=/dev/stdout -q)" \
     com.michael.iot.test.IoTDeviceBatchSimulator localhost 8888 1000
```

### 2. æ™ºèƒ½è®¾å¤‡ç®¡ç†

- **è‡ªåŠ¨å¿ƒè·³æ£€æµ‹**ï¼š60ç§’è¶…æ—¶è‡ªåŠ¨ä¸‹çº¿
- **çŠ¶æ€å®æ—¶åŒæ­¥**ï¼šè®¾å¤‡ä¸Šçº¿ä¸‹çº¿å®æ—¶é€šçŸ¥
- **æ•°æ®å®æ—¶å±•ç¤º**ï¼šä¼ æ„Ÿå™¨æ•°æ®å®æ—¶æ›´æ–°
- **æ™ºèƒ½ç­›é€‰**ï¼šæ”¯æŒæŒ‰çŠ¶æ€ã€ç±»å‹ã€åç§°ç­›é€‰è®¾å¤‡

### 3. ç°ä»£åŒ–ç”¨æˆ·ç•Œé¢

- **å“åº”å¼è®¾è®¡**ï¼šé€‚é…ä¸åŒå±å¹•å°ºå¯¸
- **å®æ—¶ç»Ÿè®¡**ï¼šè®¾å¤‡æ€»æ•°ã€åœ¨çº¿æ•°é‡ã€ç¦»çº¿æ•°é‡
- **åˆ†é¡µæ˜¾ç¤º**ï¼šæ”¯æŒ10/20/50/100æ¡è®°å½•æ¯é¡µ
- **çŠ¶æ€é€šçŸ¥**ï¼šè®¾å¤‡çŠ¶æ€å˜æ›´å®æ—¶æé†’

## å¿«é€Ÿå¼€å§‹

### ç¯å¢ƒè¦æ±‚
- Java 11+
- Maven 3.6+
- Node.js 16+
- npm 8+

### å¯åŠ¨æ­¥éª¤

1. **å¯åŠ¨åç«¯æœåŠ¡å™¨**
```bash
cd backend
mvn clean compile
mvn compile && java -cp "target/classes:$(mvn dependency:build-classpath -Dmdep.outputFile=/dev/stdout -q)" \
     com.michael.iot.server.IoTApplication 8888 8889
```

2. **å¯åŠ¨å‰ç«¯ç•Œé¢**
```bash
cd frontend
npm install
npm run dev
```

3. **æµ‹è¯•è®¾å¤‡è¿æ¥**
```bash
# è¿è¡Œè®¾å¤‡æ¨¡æ‹Ÿå™¨
java -cp "target/classes:$(mvn dependency:build-classpath -Dmdep.outputFile=/dev/stdout -q)" \
     com.michael.iot.test.IoTDeviceSimulator localhost 8888 "æ¸©åº¦ä¼ æ„Ÿå™¨" "ä¼ æ„Ÿå™¨"
```

## å­¦ä¹ ä»·å€¼

### 1. æŠ€æœ¯æ ˆå­¦ä¹ 
- **Nettyç½‘ç»œç¼–ç¨‹**ï¼šå­¦ä¹ é«˜æ€§èƒ½ç½‘ç»œæ¡†æ¶çš„ä½¿ç”¨
- **WebSocketå®æ—¶é€šä¿¡**ï¼šæŒæ¡å‰åç«¯å®æ—¶æ•°æ®æ¨é€
- **Vue3å‰ç«¯å¼€å‘**ï¼šä½“éªŒç°ä»£åŒ–å‰ç«¯æ¡†æ¶
- **Javaå¹¶å‘ç¼–ç¨‹**ï¼šç†è§£å¤šçº¿ç¨‹å’Œå¹¶å‘å¤„ç†

### 2. æ¶æ„è®¾è®¡æ€ç»´
- **æ¨¡å—åŒ–è®¾è®¡**ï¼šå­¦ä¹ å¦‚ä½•è®¾è®¡å¯æ‰©å±•çš„ç³»ç»Ÿæ¶æ„
- **äº‹ä»¶é©±åŠ¨ç¼–ç¨‹**ï¼šç†è§£è§‚å¯Ÿè€…æ¨¡å¼å’Œäº‹ä»¶å¤„ç†
- **å‰åç«¯åˆ†ç¦»**ï¼šæŒæ¡ç°ä»£Webåº”ç”¨æ¶æ„

### 3. å®æˆ˜ç»éªŒ
- **å®Œæ•´é¡¹ç›®å¼€å‘**ï¼šä»éœ€æ±‚åˆ†æåˆ°éƒ¨ç½²ä¸Šçº¿çš„å®Œæ•´æµç¨‹
- **æ€§èƒ½ä¼˜åŒ–**ï¼šå­¦ä¹ é«˜å¹¶å‘ç³»ç»Ÿçš„è®¾è®¡å’Œä¼˜åŒ–
- **é—®é¢˜æ’æŸ¥**ï¼šæŒæ¡ç³»ç»Ÿè°ƒè¯•å’Œæ•…éšœæ’é™¤æŠ€å·§

## é¡¹ç›®æ‰©å±•æ–¹å‘

è¿™ä¸ªé¡¹ç›®ä¸ºåç»­æ‰©å±•æä¾›äº†è‰¯å¥½çš„åŸºç¡€ï¼š

1. **æ•°æ®åº“é›†æˆ**ï¼šæ·»åŠ MySQL/Rediså­˜å‚¨è®¾å¤‡æ•°æ®
2. **è®¾å¤‡å‘½ä»¤ä¸‹å‘**ï¼šå®ç°è¿œç¨‹è®¾å¤‡æ§åˆ¶åŠŸèƒ½
3. **å‘Šè­¦ç³»ç»Ÿ**ï¼šåŸºäºæ•°æ®é˜ˆå€¼çš„æ™ºèƒ½å‘Šè­¦
4. **ç”¨æˆ·æƒé™ç®¡ç†**ï¼šå¤šç”¨æˆ·å’Œå¤šç§Ÿæˆ·æ”¯æŒ
5. **è®¾å¤‡å›ºä»¶å‡çº§**ï¼šOTAå›ºä»¶å‡çº§åŠŸèƒ½
6. **æ•°æ®åˆ†æ**ï¼šè®¾å¤‡æ•°æ®ç»Ÿè®¡å’Œåˆ†æåŠŸèƒ½

## æ€»ç»“

è¿™ä¸ªç‰©è”ç½‘è®¾å¤‡ç®¡ç†ç³»ç»Ÿé¡¹ç›®ä¸ä»…è§£å†³äº†æ–°æ‰‹å­¦ä¹ IoTå¼€å‘çš„é«˜æˆæœ¬é—®é¢˜ï¼Œæ›´é‡è¦çš„æ˜¯æä¾›äº†ä¸€ä¸ª**å®Œæ•´çš„ã€ç”Ÿäº§çº§çš„**å­¦ä¹ æ¡ˆä¾‹ã€‚é€šè¿‡è¿™ä¸ªé¡¹ç›®ï¼Œä½ å¯ä»¥ï¼š

- ğŸ¯ **é›¶æˆæœ¬å­¦ä¹ **ï¼šæ— éœ€è´­ä¹°ç¡¬ä»¶è®¾å¤‡
- ğŸš€ **å¿«é€Ÿä¸Šæ‰‹**ï¼šå¼€ç®±å³ç”¨çš„å®Œæ•´ç³»ç»Ÿ
- ğŸ’¡ **æ·±åº¦ç†è§£**ï¼šä»ç½‘ç»œé€šä¿¡åˆ°å‰ç«¯å±•ç¤ºçš„å®Œæ•´æŠ€æœ¯æ ˆ
- ğŸ”§ **å®æˆ˜ç»éªŒ**ï¼šä¼ä¸šçº§å¼€å‘çš„æœ€ä½³å®è·µ

## é¡¹ç›®åœ°å€

**GitHubé¡¹ç›®åœ°å€**ï¼šhttps://github.com/your-username/iot-device-manager

æ¬¢è¿Starã€Forkå’Œè´¡çŒ®ä»£ç ï¼å¦‚æœä½ æœ‰ä»»ä½•é—®é¢˜æˆ–å»ºè®®ï¼Œæ¬¢è¿åœ¨GitHubä¸Šæäº¤Issueæˆ–Pull Requestã€‚

---

*æœ¬æ–‡ä»‹ç»äº†åŸºäºNettyçš„ç‰©è”ç½‘è®¾å¤‡ç®¡ç†ç³»ç»Ÿï¼Œé€‚åˆæƒ³è¦å­¦ä¹ IoTå¼€å‘çš„æœ‹å‹ä»¬ã€‚é¡¹ç›®æä¾›äº†å®Œæ•´çš„è™šæ‹Ÿè®¾å¤‡æ¨¡æ‹Ÿå™¨ï¼Œè®©æ‚¨æ— éœ€è´­ä¹°ç¡¬ä»¶å³å¯ä½“éªŒå®Œæ•´çš„ç‰©è”ç½‘å¼€å‘æµç¨‹ã€‚*

**ç›¸å…³æ ‡ç­¾**ï¼š#ç‰©è”ç½‘ #IoT #Netty #Java #Vue3 #è®¾å¤‡ç®¡ç† #å¼€æºé¡¹ç›® #æŠ€æœ¯åˆ†äº«
